write.csv(vancouver_stations)
st_write(buildings, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
View(vancouver_stations)
colnames(vancouver_stations)
vancouver_stations <- subset(vancouver_stations, select = -c("addr:city", "addr:province"))
vancouver_stations <- subset(vancouver_stations, select = -c(`addr:city`, `addr:province`))
vancouver_stations <- subset(vancouver_stations, select = -c(air_conditions, alt_name))
vancouver_stations <- subset(vancouver_stations, select = -c(air_conditioning, alt_name))
colnames(vancouver_stations)
vancouver_stations <- subset(vancouver_stations, select = -c(iata, internet_access))
vancouver_stations <- subset(vancouver_stations, select = -c(`name:etymology:wikidata`, `name:zh`))
vancouver_stations <- subset(vancouver_stations, select = -c(`network:short`, `network:wikidata`))
colnames(vancouver_stations)
vancouver_stations <- subset(vancouver_stations, select = -c(`not:network:wikidata`, `operator:wikidata`))
vancouver_stations <- subset(vancouver_stations, select = -c(`ref:amtrak`, `ref:via_rail`))
colnames(vancouver_stations)
vancouver_stations <- subset(vancouver_stations, select = -c(wikipedia,wheelchair,website)
)
vancouver_stations <- subset(vancouver_stations, select = -c(old_name,opening_hours)
)
vancouver_stations <- subset(vancouver_stations, select = -c('railwayref',source))
vancouver_stations <- subset(vancouver_stations, select = -c('railwayref',`source))
vancouver_stations <- subset(vancouver_stations, select = -c('railwayref',`source`))
vancouver_stations <- subset(vancouver_stations, select = -c('railway:ref',`source`))
vancouver_stations <- subset(vancouver_stations, select = -c('railway:ref'))
vancouver_stations <- subset(vancouver_stations, select = -c(`railway:ref`))
vancouver_stations <- subset(vancouver_stations, select = -c(`source`))
vancouver_stations <- subset(vancouver_stations, select = -c(wikidata))
vancouver_stations <- subset(vancouver_stations, select = -c(station,subway,train,public_transport))
vancouver_stations <- subset(vancouver_stations, select = -c(operator))
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 6481882067, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 7012109787, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5324667872, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5328609486, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5325408927, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5325408472, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5324734517, ]
bbox_vancouver <- c(left = -123.2, bottom = 49, right = -122.75, top = 49.4)
#find stations in Vancouver
vancouver_stations <- opq(bbox = bbox_vancouver) %>%
add_osm_feature(key = 'railway', value = 'station') %>%
osmdata_sf()
#convert to df
vancouver_stations<-vancouver_stations$osm_points
#convert the sfc_point data.class into numeric values in a matrix
van_stations_coords<-st_coordinates(vancouver_stations$geometry)
#append the matrix columns as new variables in the data.frame
vancouver_stations$lon <- van_stations_coords[,1]
vancouver_stations$lat <- van_stations_coords[,2]
View(vancouver_stations)
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5328609486, ]
colnames(vancouver_stations)
vancouver_stations <- subset(vancouver_stations, select = c(osm_id,name,network,railway,start_date,subway,geometry,lon,lat))
map_osm_data(vancouver_stations,56)
map_osm_data(vancouver_stations,57)
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 6481882067, ]
runApp()
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 6481882067, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 7012109787, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 3956040167, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5328619638, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5328609486, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 5328604043, ]
vancouver_stations <- vancouver_stations[!vancouver_stations$osm_id == 8576664378, ]
setwd("~/danielhsieh.github.io/vancouver_shiny/vancouver_metros")
st_write(buildings, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
st_write(vancouver_stations, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
st_write(vancouver_stations, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
rm(vancouver_stations)
rm(vancouver_buildings)
rm(new_buildings)
rm(van_stations_coords)
runApp()
runApp()
runApp()
runApp()
runApp()
vancouver_stations<-st_read("vancouver_stations.csv")
class(vancouver_stations)
vancouver_stations_sf <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
class(vancouver_stations)
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
class(vancouver_stations)
rm(vancouver_stations)
rm(vancouver_stations_sf
)
runApp()
runApp()
vancouver_stations<-st_read("vancouver_stations.csv")
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
class(vancouver_stations)
View(vancouver_stations)
#convert the sfc_point data.class into numeric values in a matrix
van_stations_coords<-st_coordinates(vancouver_stations$geometry)
#append the matrix columns as new variables in the data.frame
vancouver_stations$lon <- van_stations_coords[,1]
vancouver_stations$lat <- van_stations_coords[,2]
st_write(vancouver_stations, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
rm(vancouver_stations)
rm(van_stations_coords)
rm(buildings)
vancouver_stations<-st_read("vancouver_stations.csv")
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
class(vancouver_stations)
View(vancouver_stations)
#convert the sfc_point data.class into numeric values in a matrix
van_stations_coords<-st_coordinates(vancouver_stations$geometry)
#append the matrix columns as new variables in the data.frame
vancouver_stations$lon <- van_stations_coords[,1]
vancouver_stations$lat <- van_stations_coords[,2]
st_write(vancouver_stations, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
View(vancouver_stations)
st_write(vancouver_stations, "~/danielhsieh.github.io/vancouver_shiny/vancouver_metros/vancouver_stations.csv")
rm(vancouver_stations)
vancouver_stations<-st_read("vancouver_stations.csv")
View(vancouver_stations)
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
View(vancouver_stations)
class(vancouver_stations)
van_stations_coords<-st_coordinates(vancouver_stations$geometry)
vancouver_stations<-st_read("vancouver_stations.csv")
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
rm(vancouver_stations)
rm(van_stations_coords)
vancouver_stations<-st_read("vancouver_stations.csv")
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
vancouver_stations$lon<-st_coordinates(vancouver_stations$geometry)[,1]
View(vancouver_stations)
vancouver_stations$lat<-st_coordinates(vancouver_stations$geometry)[,2]
View(vancouver_stations)
runApp()
rm(vancouver_stations)
runApp()
runApp()
vancouver_stations<-st_read("vancouver_stations.csv")
require(osmdata)
require(tmap)
require(leaflet)
require(sf)
vancouver_stations<-st_read("vancouver_stations.csv")
setwd("~/danielhsieh.github.io/vancouver_shiny/vancouver_metros")
vancouver_stations<-st_read("vancouver_stations.csv")
vancouver_stations <- st_as_sf(vancouver_stations, coords = c("lon", "lat"), crs = 4326)
class(vancouver_stations)
View(vancouver_stations)
map_osm_data(vancouver_stations,which(vancouver_stations$name == 'Oakridge-41st Avenue'))
map_osm_data(vancouver_stations,which(vancouver_stations$name == 'Oakridge-41st Avenue'))
rlang::last_trace()
map_osm_data(vancouver_stations,43)
require(osmdata)
buildings <- opq_around (vancouver_stations$lon[43], vancouver_stations$lat[43], 800, key = "building") %>%
osmdata_sf ()
rlang::last_trace()
rlang::last_trace(drop = FALSE)
buildings <- opq_around(vancouver_stations$lon[data()],
vancouver_stations$lat[data()],
800, key = "building") %>%
osmdata_sf()
shiny::runApp()
buildings <- opq_around(vancouver_stations$lon[43],
vancouver_stations$lat[43],
800, key = "building") %>%
osmdata_sf()
rlang::last_trace()
rlang::last_trace(drop = FALSE)
runApp()
st_area(buildings)
buildings$area <- st_area(buildings)
require(sf)
class(buildings)
buildings <- opq_around(vancouver_stations$lon[43],
vancouver_stations$lat[43],
800, key = "building") %>%
osmdata_sf()
View(buildings)
buildings <- buildings$osm_polygons
buildings$`building:levels` <- as.numeric(buildings$`building:levels`)
sf::st_as_sf(buildings)
class(buildings)
buildings$area <- st_area(buildings)
View(buildings)
runApp()
View(buildings)
runApp()
rm(buildings)
runApp()
runApp()
barplot(buildings$area, main = "Distribution of Building Area",
xlab = "Building", ylab = "Area")
barplot(as.numeric(buildings$area), main = "Distribution of Building Area",
+         xlab = "Building", ylab = "Area")
barplot(as.numeric(buildings$area), main = "Distribution of Building Area",xlab = "Building", ylab = "Area")
barplot(as.numeric(buildings$area),
main = "Distribution of Building Area",
xlab = "Building",
ylab = "Area",
breaks=10)
barplot(as.numeric(buildings$area),
main = "Distribution of Building Area",
xlab = "Building",
ylab = "Area",
breaks=10)
runApp()
map_osm_data <- function(df,i) {
#buildings
buildings <- opq_around (df$lon[i], df$lat[i], 800, key = "building") %>%
osmdata_sf ()
#data clean-up
buildings<-buildings$osm_polygons
buildings$`building:levels`<-as.numeric(buildings$`building:levels`)
#view the map
tmap_mode("view")
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels')
) +
tm_shape(df) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(df$lon[i],df$lat[i],16))
}
map_osm_data(vancouver_stations,43)
rlang::last_trace()
rlang::last_trace(drop = FALSE)
runApp()
runApp()
runApp()
runApp()
install.packages("plotly")
require(plotly)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
help(hist)
runApp()
ggplot(buildings, aes(x = `building:levels`, y = area)) +
geom_bar(stat = "sum", position = "dodge", fill = "blue") +
labs(title = "Total Area by Building Levels",
x = "Building Levels",
y = "Total Area") +
theme_minimal()
class(buildings$area)
buildings$area<-as.numeric(buildings$area)
class(buildings$area)
ggplot(buildings, aes(x = `building:levels`, y = area)) +
geom_bar(stat = "sum", position = "dodge", fill = "blue") +
labs(title = "Total Area by Building Levels",
x = "Building Levels",
y = "Total Area") +
theme_minimal()
buildings <- buildings %>%
mutate(building_level_category = case_when(
`building:levels` >= 0 & `building:levels` <= 8 ~ "0-8",
`building:levels` >= 9 & `building:levels` <= 12 ~ "9-12",
`building:levels` >= 13 & `building:levels` <= 20 ~ "13-20",
`building:levels` >= 21 ~ "21 and up"
))
require(dplyr)
buildings <- buildings %>%
mutate(building_level_category = case_when(
`building:levels` >= 0 & `building:levels` <= 8 ~ "0-8",
`building:levels` >= 9 & `building:levels` <= 12 ~ "9-12",
`building:levels` >= 13 & `building:levels` <= 20 ~ "13-20",
`building:levels` >= 21 ~ "21 and up"
))
colnames(buildings)
ggplot(buildings, aes(x = building_level_category, y = area)) +
geom_bar(stat = "sum", position = "dodge", fill = "blue") +
labs(title = "Total Area by Building Levels",
x = "Building Levels",
y = "Total Area") +
theme_minimal()
plot_ly(buildings, x = ~building_level_category, y = ~area, type = "bar", marker = list(color = "blue")) %>%
layout(title = "Total Area by Building Levels",
xaxis = list(title = "Building Levels"),
yaxis = list(title = "Total Area"),
showlegend = FALSE)
class(buildings$geometry)
runApp()
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels')
) +
tm_shape(df) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(df$lon[i],df$lat[i],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels')
) +
tm_shape(df) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(df$lon[i],df$lat[i],16))
map_osm_data <- function(df,i) {
#buildings
buildings <- opq_around (df$lon[i], df$lat[i], 800, key = "building") %>%
osmdata_sf ()
#data clean-up
buildings<-buildings$osm_polygons
buildings$`building:levels`<-as.numeric(buildings$`building:levels`)
#view the map
tmap_mode("view")
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels')
) +
tm_shape(df) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(df$lon[i],df$lat[i],16))
}
map_osm_data(vancouver_stations,43)
gc()
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels')
) +
tm_shape(df) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels')
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',n = 5)
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',n = 5)
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
View(vancouver_stations)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',n = 10)
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',n = 2)
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style='jenks',n = 2)
)
runApp()
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style='jenks',n = 2)
)
runApp()
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style='jenks',n = 2)
)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style='jenks',n = 10)
)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',breaks = 5)
)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',breaks = 10)
)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',breaks = 10)
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',breaks = 2)
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style=="fixed",breaks = 2)
)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style="fixed",breaks = 2)
)
tm_shape(buildings) +
tm_polygons("building:levels",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building:levels',style="fixed",breaks = 10)
)
colnames(buildings)
buildings$area<-as.numeric(buildings$area)
buildings <- buildings %>%
mutate(building_level_category = case_when(
`building:levels` >= 0 & `building:levels` <= 8 ~ "0-8",
`building:levels` >= 9 & `building:levels` <= 12 ~ "9-12",
`building:levels` >= 13 & `building:levels` <= 20 ~ "13-20",
`building:levels` >= 21 ~ "21 and up"
))
tm_shape(buildings) +
tm_polygons("building_level_category",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building_level_category')
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tmap_mode("view")
tm_shape(buildings) +
tm_polygons("building_level_category",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building_level_category')
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building_level_category",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building_level_category')
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5) +
tm_view(set.view = c(vancouver_stations$lon[43],vancouver_stations$lat[43],16))
tm_shape(buildings) +
tm_polygons("building_level_category",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building_level_category')
) +
tm_shape(vancouver_stations) +
tm_dots(col='red',size=1,alpha=0.5)
class(buildings$building_level_category)
View(buildings)
buildings$building_level_category<-buildings %>%
mutate(building_level_category = factor(building_level_category, levels = c("0-8", "9-12", "13-20", "21 and up")))
class(buildings$building_level_category)
class(buildings$building_level_category)
tm_shape(buildings) +
tm_polygons("building_level_category",palette="YlGnBu",
popup.vars = c('Name: ' = 'name',
'Building: ' = 'building',
'Levels' = 'building_level_category'))
class(buildings)
runApp()
rm(buildings)
rm(vancouver_stations)
